INFO:     Will watch for changes in these directories: ['/home/isaac/Documents/code/side-b/backend']
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
INFO:     Started reloader process [286081] using WatchFiles
/home/isaac/Documents/code/side-b/backend/venv/lib/python3.10/site-packages/pydantic/_internal/_config.py:383: UserWarning: Valid config keys have changed in V2:
* 'allow_population_by_field_name' has been renamed to 'validate_by_name'
* 'schema_extra' has been renamed to 'json_schema_extra'
  warnings.warn(message, UserWarning)
INFO:     Started server process [286111]
INFO:     Waiting for application startup.
[Cassandra] INFO - Connecting to Cassandra cluster...
[Cassandra] INFO - Connected and keyspace set to 'sideb'
[Cassandra] INFO - Ensuring Cassandra schema...
[Cassandra] INFO - Cassandra schema ensured.
INFO:     Application startup complete.
âœ“ Connected to mongodb
âœ“ Connected to cassandra
âœ“ Connected to Dgraph
âœ“ Connected to dgraph
âœ“ Database initialized
âœ“ Initialized mongodb
âœ— Failed to initialize cassandra: 'CassandraClient' object has no attribute 'initialize'
âœ“ Initialized dgraph
âœ“ Cassandra tables initialized
âœ“ Mood anchors already present (34 anchors).
âœ“ ChromaDB initialized
INFO:     127.0.0.1:51272 - "OPTIONS /auth/me HTTP/1.1" 200 OK
INFO:     127.0.0.1:51286 - "OPTIONS /auth/me HTTP/1.1" 200 OK
INFO:     127.0.0.1:51272 - "GET /auth/me HTTP/1.1" 401 Unauthorized
INFO:     127.0.0.1:51286 - "GET /auth/me HTTP/1.1" 401 Unauthorized
INFO:     127.0.0.1:32800 - "OPTIONS /songs/recommend HTTP/1.1" 200 OK
INFO:     127.0.0.1:32806 - "OPTIONS /songs/recommend HTTP/1.1" 200 OK
ðŸ” Text classified as: sad
Recommendation requested for text: 'Im feel so depressed and lonel...' -> Detected Mood: sad
ðŸ” Querying ChromaDB for songs with mood=sad and text='Im feel so depressed and lonely today...'
ðŸ” ChromaDB query_songs called with:
   - query_text: 'Im feel so depressed and lonely today...'
   - mood: sad
   - n_results: 8
   - where_clause: {'mood': 'sad'}
âœ… ChromaDB returned: 8 results
ðŸ“Š ChromaDB Results: {'ids': [['693253cc0e8a8580342af211', '693253cc0e8a8580342af228', '693253cc0e8a8580342af217', '693253cc0e8a8580342af214', '693253cc0e8a8580342af224', '693253cc0e8a8580342af220', '693253cc0e8a8580342af226', '693253cc0e8a8580342af222']], 'embeddings': None, 'documents': [['Soulful longing and loneliness.', 'The loneliness of being too much.', 'Deeply personal and moving grief.', 'Quiet, haunting melancholy.', 'Ideally sad and comforting.', 'Desperation and helplessness.', 'A somber look at the world.', 'Rock ballad of loss.']], 'uris': None, 'included': ['metadatas', 'documents', 'distances'], 'data': None, 'metadatas': [[{'album': 'In The Lonely Hour (Drowning Shadows Edition)', 'mood': 'sad', 'title': 'Stay With Me', 'artist': 'Sam Smith'}, {'mood': 'sad', 'title': 'Liability', 'album': 'Melodrama', 'artist': 'Lorde'}, {'album': 'Unplugged (Live)', 'artist': 'Eric Clapton', 'mood': 'sad', 'title': 'Tears in Heaven (Acoustic Live)'}, {'album': 'WHEN WE ALL FALL ASLEEP, WHERE DO WE GO?', 'artist': 'Billie Eilish', 'mood': 'sad', 'title': "when the party's over"}, {'album': 'Surfacing', 'artist': 'Sarah McLachlan', 'mood': 'sad', 'title': 'Angel'}, {'mood': 'sad', 'artist': 'The Fray', 'title': 'How to Save a Life', 'album': 'How To Save A Life'}, {'title': 'Mad World', 'artist': 'Michael Andrews', 'mood': 'sad', 'album': 'Donnie Darko (Original Motion Picture Soundtrack)'}, {'artist': 'Green Day', 'title': 'Wake Me up When September Ends', 'mood': 'sad', 'album': 'American Idiot (Deluxe)'}]], 'distances': [[1.1405231952667236, 1.237744927406311, 1.4031310081481934, 1.4128592014312744, 1.4798718690872192, 1.49152672290802, 1.4958150386810303, 1.549816608428955]]}
ðŸŽµ Found 8 song IDs from ChromaDB: ['693253cc0e8a8580342af211', '693253cc0e8a8580342af228', '693253cc0e8a8580342af217']...
ðŸ“ Similarity distances: [1.1405231952667236, 1.237744927406311, 1.4031310081481934]...
ðŸ” Converting song IDs to ObjectId format...
âœ… Converted 8 IDs. First few: [ObjectId('693253cc0e8a8580342af211'), ObjectId('693253cc0e8a8580342af228'), ObjectId('693253cc0e8a8580342af217')]
ðŸ” MongoDB query: {'_id': {'$in': [ObjectId('693253cc0e8a8580342af211'), ObjectId('693253cc0e8a8580342af228'), ObjectId('693253cc0e8a8580342af217'), ObjectId('693253cc0e8a8580342af214'), ObjectId('693253cc0e8a8580342af224'), ObjectId('693253cc0e8a8580342af220'), ObjectId('693253cc0e8a8580342af226'), ObjectId('693253cc0e8a8580342af222')]}}
ðŸ” Text classified as: sad
Recommendation requested for text: 'Im feel so depressed and lonel...' -> Detected Mood: sad
ðŸ” Querying ChromaDB for songs with mood=sad and text='Im feel so depressed and lonely today...'
ðŸ” ChromaDB query_songs called with:
   - query_text: 'Im feel so depressed and lonely today...'
   - mood: sad
   - n_results: 8
   - where_clause: {'mood': 'sad'}
âœ… ChromaDB returned: 8 results
ðŸ“Š ChromaDB Results: {'ids': [['693253cc0e8a8580342af211', '693253cc0e8a8580342af228', '693253cc0e8a8580342af217', '693253cc0e8a8580342af214', '693253cc0e8a8580342af224', '693253cc0e8a8580342af220', '693253cc0e8a8580342af226', '693253cc0e8a8580342af222']], 'embeddings': None, 'documents': [['Soulful longing and loneliness.', 'The loneliness of being too much.', 'Deeply personal and moving grief.', 'Quiet, haunting melancholy.', 'Ideally sad and comforting.', 'Desperation and helplessness.', 'A somber look at the world.', 'Rock ballad of loss.']], 'uris': None, 'included': ['metadatas', 'documents', 'distances'], 'data': None, 'metadatas': [[{'title': 'Stay With Me', 'artist': 'Sam Smith', 'album': 'In The Lonely Hour (Drowning Shadows Edition)', 'mood': 'sad'}, {'title': 'Liability', 'mood': 'sad', 'artist': 'Lorde', 'album': 'Melodrama'}, {'artist': 'Eric Clapton', 'title': 'Tears in Heaven (Acoustic Live)', 'mood': 'sad', 'album': 'Unplugged (Live)'}, {'album': 'WHEN WE ALL FALL ASLEEP, WHERE DO WE GO?', 'artist': 'Billie Eilish', 'title': "when the party's over", 'mood': 'sad'}, {'title': 'Angel', 'mood': 'sad', 'album': 'Surfacing', 'artist': 'Sarah McLachlan'}, {'album': 'How To Save A Life', 'artist': 'The Fray', 'title': 'How to Save a Life', 'mood': 'sad'}, {'mood': 'sad', 'title': 'Mad World', 'artist': 'Michael Andrews', 'album': 'Donnie Darko (Original Motion Picture Soundtrack)'}, {'artist': 'Green Day', 'title': 'Wake Me up When September Ends', 'album': 'American Idiot (Deluxe)', 'mood': 'sad'}]], 'distances': [[1.1405231952667236, 1.237744927406311, 1.4031310081481934, 1.4128592014312744, 1.4798718690872192, 1.49152672290802, 1.4958150386810303, 1.549816608428955]]}
ðŸŽµ Found 8 song IDs from ChromaDB: ['693253cc0e8a8580342af211', '693253cc0e8a8580342af228', '693253cc0e8a8580342af217']...
ðŸ“ Similarity distances: [1.1405231952667236, 1.237744927406311, 1.4031310081481934]...
ðŸ” Converting song IDs to ObjectId format...
âœ… Converted 8 IDs. First few: [ObjectId('693253cc0e8a8580342af211'), ObjectId('693253cc0e8a8580342af228'), ObjectId('693253cc0e8a8580342af217')]
ðŸ” MongoDB query: {'_id': {'$in': [ObjectId('693253cc0e8a8580342af211'), ObjectId('693253cc0e8a8580342af228'), ObjectId('693253cc0e8a8580342af217'), ObjectId('693253cc0e8a8580342af214'), ObjectId('693253cc0e8a8580342af224'), ObjectId('693253cc0e8a8580342af220'), ObjectId('693253cc0e8a8580342af226'), ObjectId('693253cc0e8a8580342af222')]}}
ðŸ“¦ MongoDB returned 8 songs
âœ… Returning 8 semantically matched songs
INFO:     127.0.0.1:32806 - "POST /songs/recommend HTTP/1.1" 200 OK
ðŸ“¦ MongoDB returned 8 songs
âœ… Returning 8 semantically matched songs
INFO:     127.0.0.1:32800 - "POST /songs/recommend HTTP/1.1" 200 OK
INFO:     127.0.0.1:54622 - "OPTIONS /auth/register HTTP/1.1" 200 OK
INFO:     127.0.0.1:54622 - "POST /auth/register HTTP/1.1" 201 Created
INFO:     127.0.0.1:54622 - "OPTIONS /entries/ HTTP/1.1" 200 OK
[Cassandra] INFO - Logged journal text for user=69325f7b2c61ed81c1f75e6a, entry=69325f7b2c61ed81c1f75e6b
DEBUG: Entry 69325f7b2c61ed81c1f75e6b -> User 69325f7b2c61ed81c1f75e6a resolved to UID 0x4e62
INFO:     127.0.0.1:54638 - "OPTIONS /users/69325f7b2c61ed81c1f75e6a/stats HTTP/1.1" 200 OK
INFO:     127.0.0.1:54640 - "OPTIONS /entries/?userId=69325f7b2c61ed81c1f75e6a HTTP/1.1" 200 OK
INFO:     127.0.0.1:54640 - "GET /entries/?userId=69325f7b2c61ed81c1f75e6a HTTP/1.1" 200 OK
[Cassandra] INFO - Logged song selection for user=69325f7b2c61ed81c1f75e6a, song=693253cc0e8a8580342af228
INFO:     127.0.0.1:54622 - "POST /entries/ HTTP/1.1" 200 OK
INFO:     127.0.0.1:54638 - "GET /users/69325f7b2c61ed81c1f75e6a/stats HTTP/1.1" 200 OK
INFO:     127.0.0.1:54638 - "GET /users/69325f7b2c61ed81c1f75e6a/stats HTTP/1.1" 200 OK
INFO:     127.0.0.1:47194 - "OPTIONS /users/69325f7b2c61ed81c1f75e6a HTTP/1.1" 200 OK
INFO:     127.0.0.1:47200 - "GET /entries/?userId=69325f7b2c61ed81c1f75e6a HTTP/1.1" 200 OK
INFO:     127.0.0.1:47194 - "PUT /users/69325f7b2c61ed81c1f75e6a HTTP/1.1" 200 OK
INFO:     127.0.0.1:47198 - "GET /users/69325f7b2c61ed81c1f75e6a/stats HTTP/1.1" 200 OK
INFO:     127.0.0.1:47198 - "PUT /users/69325f7b2c61ed81c1f75e6a HTTP/1.1" 200 OK
INFO:     127.0.0.1:47200 - "GET /entries/?userId=69325f7b2c61ed81c1f75e6a HTTP/1.1" 200 OK
INFO:     127.0.0.1:47194 - "GET /users/69325f7b2c61ed81c1f75e6a/stats HTTP/1.1" 200 OK
INFO:     127.0.0.1:47198 - "GET /entries/?userId=69325f7b2c61ed81c1f75e6a HTTP/1.1" 200 OK
INFO:     127.0.0.1:47194 - "PUT /users/69325f7b2c61ed81c1f75e6a HTTP/1.1" 200 OK
INFO:     127.0.0.1:47200 - "GET /users/69325f7b2c61ed81c1f75e6a/stats HTTP/1.1" 200 OK
INFO:     127.0.0.1:47198 - "GET /entries/?userId=69325f7b2c61ed81c1f75e6a HTTP/1.1" 200 OK
INFO:     127.0.0.1:47200 - "PUT /users/69325f7b2c61ed81c1f75e6a HTTP/1.1" 200 OK
INFO:     127.0.0.1:47194 - "GET /users/69325f7b2c61ed81c1f75e6a/stats HTTP/1.1" 200 OK
INFO:     127.0.0.1:45152 - "GET /entries/?userId=69325f7b2c61ed81c1f75e6a HTTP/1.1" 200 OK
INFO:     127.0.0.1:45140 - "PUT /users/69325f7b2c61ed81c1f75e6a HTTP/1.1" 200 OK
INFO:     127.0.0.1:45148 - "GET /users/69325f7b2c61ed81c1f75e6a/stats HTTP/1.1" 200 OK
INFO:     127.0.0.1:45164 - "GET /entries/?userId=69325f7b2c61ed81c1f75e6a HTTP/1.1" 200 OK
INFO:     127.0.0.1:45154 - "PUT /users/69325f7b2c61ed81c1f75e6a HTTP/1.1" 200 OK
INFO:     127.0.0.1:45162 - "GET /users/69325f7b2c61ed81c1f75e6a/stats HTTP/1.1" 200 OK
INFO:     127.0.0.1:45164 - "GET /entries/?userId=69325f7b2c61ed81c1f75e6a HTTP/1.1" 200 OK
INFO:     127.0.0.1:45162 - "PUT /users/69325f7b2c61ed81c1f75e6a HTTP/1.1" 200 OK
INFO:     127.0.0.1:45154 - "GET /users/69325f7b2c61ed81c1f75e6a/stats HTTP/1.1" 200 OK
INFO:     127.0.0.1:45164 - "GET /entries/?userId=69325f7b2c61ed81c1f75e6a HTTP/1.1" 200 OK
INFO:     127.0.0.1:45154 - "PUT /users/69325f7b2c61ed81c1f75e6a HTTP/1.1" 200 OK
INFO:     127.0.0.1:45162 - "GET /users/69325f7b2c61ed81c1f75e6a/stats HTTP/1.1" 200 OK
INFO:     127.0.0.1:50980 - "OPTIONS /users/69325f7b2c61ed81c1f75e6a/data HTTP/1.1" 200 OK
[Cassandra] WARNING - [DELETE] Removing ALL Cassandra data for user 69325f7b2c61ed81c1f75e6a
Error deleting Cassandra data: Error from server: code=2200 [Invalid query] message="SELECT DISTINCT queries must request all the partition key columns (missing user_id)"
âœ… Deleted ChromaDB entries for user 69325f7b2c61ed81c1f75e6a
INFO:     127.0.0.1:50980 - "DELETE /users/69325f7b2c61ed81c1f75e6a/data HTTP/1.1" 200 OK
INFO:     127.0.0.1:56170 - "GET /auth/me HTTP/1.1" 200 OK
INFO:     127.0.0.1:56184 - "GET /auth/me HTTP/1.1" 200 OK
INFO:     127.0.0.1:56170 - "GET /entries/?userId=69325f7b2c61ed81c1f75e6a HTTP/1.1" 200 OK
INFO:     127.0.0.1:56184 - "GET /users/69325f7b2c61ed81c1f75e6a/stats HTTP/1.1" 200 OK
INFO:     127.0.0.1:56170 - "GET /entries/?userId=69325f7b2c61ed81c1f75e6a HTTP/1.1" 200 OK
INFO:     127.0.0.1:56184 - "GET /users/69325f7b2c61ed81c1f75e6a/stats HTTP/1.1" 200 OK
[Cassandra] WARNING - [DELETE] Removing ALL Cassandra data for user 69325f7b2c61ed81c1f75e6a
Error deleting Cassandra data: Error from server: code=2200 [Invalid query] message="SELECT DISTINCT queries must request all the partition key columns (missing user_id)"
âœ… Deleted ChromaDB entries for user 69325f7b2c61ed81c1f75e6a
Error deleting Dgraph user: 'DgraphClient' object has no attribute 'delete_user'
INFO:     127.0.0.1:47498 - "DELETE /users/69325f7b2c61ed81c1f75e6a HTTP/1.1" 200 OK
